{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://api.gymbro.cloud/schemas/message_sse_frame.schema.json",
  "title": "MessageSseFrame",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "event": { "type": "string", "enum": ["status", "content_delta", "upstream_raw", "completed", "error", "heartbeat"] },
    "data": { "type": "object" }
  },
  "required": ["event", "data"],
  "oneOf": [
    {
      "properties": { "event": { "const": "status" }, "data": { "$ref": "#/$defs/StatusData" } },
      "required": ["event", "data"]
    },
    {
      "properties": { "event": { "const": "content_delta" }, "data": { "$ref": "#/$defs/ContentDeltaData" } },
      "required": ["event", "data"]
    },
    {
      "properties": { "event": { "const": "upstream_raw" }, "data": { "$ref": "#/$defs/UpstreamRawData" } },
      "required": ["event", "data"]
    },
    {
      "properties": { "event": { "const": "completed" }, "data": { "$ref": "#/$defs/CompletedData" } },
      "required": ["event", "data"]
    },
    {
      "properties": { "event": { "const": "error" }, "data": { "$ref": "#/$defs/ErrorData" } },
      "required": ["event", "data"]
    },
    {
      "properties": { "event": { "const": "heartbeat" }, "data": { "$ref": "#/$defs/HeartbeatData" } },
      "required": ["event", "data"]
    }
  ],
  "$defs": {
    "RequestId": { "type": "string", "minLength": 1 },
    "MessageId": { "type": "string", "pattern": "^[0-9a-f]{32}$" },
    "StatusData": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "state": { "type": "string", "enum": ["queued", "working", "routed"] },
        "message_id": { "$ref": "#/$defs/MessageId" },
        "request_id": { "$ref": "#/$defs/RequestId" },
        "provider": { "type": ["string", "null"] },
        "resolved_model": { "type": ["string", "null"] },
        "endpoint_id": { "type": ["integer", "null"] },
        "upstream_request_id": { "type": ["string", "null"] }
      },
      "required": ["state", "message_id", "request_id"]
    },
    "ContentDeltaData": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "message_id": { "$ref": "#/$defs/MessageId" },
        "request_id": { "$ref": "#/$defs/RequestId" },
        "seq": { "type": "integer", "minimum": 1 },
        "delta": { "type": "string", "minLength": 1 }
      },
      "required": ["message_id", "request_id", "seq", "delta"]
    },
    "UpstreamRawData": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "message_id": { "$ref": "#/$defs/MessageId" },
        "request_id": { "$ref": "#/$defs/RequestId" },
        "seq": { "type": "integer", "minimum": 1 },
        "dialect": { "type": ["string", "null"] },
        "upstream_event": { "type": ["string", "null"] },
        "raw": { "type": "string", "minLength": 1 }
      },
      "required": ["message_id", "request_id", "seq", "raw"]
    },
    "CompletedData": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "message_id": { "$ref": "#/$defs/MessageId" },
        "request_id": { "$ref": "#/$defs/RequestId" },
        "provider": { "type": ["string", "null"] },
        "resolved_model": { "type": ["string", "null"] },
        "endpoint_id": { "type": ["integer", "null"] },
        "upstream_request_id": { "type": ["string", "null"] },
        "result_mode": { "type": ["string", "null"] },
        "result_mode_effective": { "type": ["string", "null"] },
        "reply_len": { "type": "integer", "minimum": 0 },
        "reply_snapshot_included": { "type": "boolean" },
        "metadata": { "type": ["object", "null"], "additionalProperties": true }
      },
      "required": ["message_id", "request_id", "reply_len", "reply_snapshot_included"]
    },
    "ErrorData": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "message_id": { "$ref": "#/$defs/MessageId" },
        "request_id": { "$ref": "#/$defs/RequestId" },
        "code": { "type": "string", "minLength": 1 },
        "message": { "type": "string", "minLength": 1 },
        "error": { "type": ["string", "null"] },
        "provider": { "type": ["string", "null"] },
        "resolved_model": { "type": ["string", "null"] },
        "endpoint_id": { "type": ["integer", "null"] }
      },
      "required": ["message_id", "request_id", "code", "message"]
    },
    "HeartbeatData": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "message_id": { "$ref": "#/$defs/MessageId" },
        "request_id": { "$ref": "#/$defs/RequestId" },
        "ts": { "type": "integer", "minimum": 0 }
      },
      "required": ["message_id", "request_id", "ts"]
    }
  }
}
