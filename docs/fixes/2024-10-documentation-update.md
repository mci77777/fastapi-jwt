# é¡¹ç›®æ–‡æ¡£æ›´æ–°äº¤ä»˜æŠ¥å‘Š

**äº¤ä»˜æ—¥æœŸ**ï¼š2025-10-13  
**ä»»åŠ¡ç›®æ ‡**ï¼šå®¡æŸ¥å¹¶æ›´æ–°é¡¹ç›®æ–‡æ¡£ï¼Œä½¿å…¶å‡†ç¡®åæ˜ å½“å‰åç«¯æœåŠ¡å¯¹æ¥çš„çœŸå®çŠ¶æ€  
**æ‰§è¡ŒåŸåˆ™**ï¼šSSOTï¼ˆå•ä¸€çœŸå€¼æ¥æºï¼‰- æ‰€æœ‰æ–‡æ¡£åŸºäºä»£ç å®é™…çŠ¶æ€æ›´æ–°

---

## ğŸ“Š ç°çŠ¶åˆ†ææ€»ç»“

### 1. ç«¯å£é…ç½®éªŒè¯

é€šè¿‡æ£€æŸ¥ `start-dev.ps1`ã€`run.py`ã€`web/vite.config.js` ç­‰æºç ï¼Œç¡®è®¤å®é™…é…ç½®ï¼š

| æœåŠ¡ | ç«¯å£ | é…ç½®æ–‡ä»¶ | çŠ¶æ€ |
|------|------|----------|------|
| å‰ç«¯å¼€å‘æœåŠ¡å™¨ | 3101 | `web/.env.development` | âœ… æ­£ç¡® |
| åç«¯ API æœåŠ¡ | 9999 | `run.py` | âœ… æ­£ç¡® |
| ç”Ÿäº§ç¯å¢ƒ Nginx | 80 | `Dockerfile`, `docker-compose.yml` | âœ… æ­£ç¡® |

### 2. æ–‡æ¡£å·®å¼‚æ¸…å•

| æ–‡æ¡£ | ä½ç½® | é—®é¢˜ | ä¿®å¤çŠ¶æ€ |
|------|------|------|----------|
| `README.md` | ç¬¬ 112 è¡Œ | âœ… ç«¯å£æ­£ç¡® | å·²ä¼˜åŒ– |
| `AGENTS.md` | ç¬¬ 71 è¡Œ | âŒ å‰ç«¯ç«¯å£å†™æˆ 5173 | âœ… å·²ä¿®å¤ä¸º 3101 |
| `CLAUDE.md` | ç¬¬ 47 è¡Œ | âŒ å‰ç«¯ç«¯å£å†™æˆ 5173 | âœ… å·²ä¿®å¤ä¸º 3101 |
| `Dockerfile` | ç¬¬ 31 è¡Œ | âš ï¸ ç¼ºå°‘ç«¯å£è¯´æ˜ | âœ… å·²æ·»åŠ æ³¨é‡Š |
| `docker-compose.yml` | ç¬¬ 1-14 è¡Œ | âš ï¸ ç¼ºå°‘ç¯å¢ƒè¯´æ˜ | âœ… å·²æ·»åŠ æ³¨é‡Š |

### 3. API ç«¯ç‚¹çœŸå®çŠ¶æ€

ä» `app/api/v1/__init__.py` æå–çš„å®é™…è·¯ç”±æ³¨å†Œï¼š

```python
v1_router.include_router(base_router)        # /api/v1/base/*
v1_router.include_router(dashboard_router)   # /api/v1/dashboard/*
v1_router.include_router(health_router)      # /api/v1/health/*
v1_router.include_router(llm_router)         # /api/v1/llm/*
v1_router.include_router(messages_router)    # /api/v1/messages/*
v1_router.include_router(metrics_router)     # /api/v1/metrics
```

---

## ğŸ”§ æ‰§è¡Œçš„å˜æ›´

### å˜æ›´ 1ï¼šREADME.md - å¿«é€Ÿå¼€å§‹ç« èŠ‚é‡æ„

**æ–‡ä»¶**ï¼š`README.md` (ç¬¬ 22-68 è¡Œ)

**å˜æ›´å†…å®¹**ï¼š
- âœ… æ–°å¢"æ–¹æ³•ä¸€ï¼šä¸€é”®å¯åŠ¨å¼€å‘ç¯å¢ƒ"ï¼ˆæ¨èä½¿ç”¨ `start-dev.ps1`ï¼‰
- âœ… æ˜ç¡®æ ‡æ³¨è®¿é—®åœ°å€ï¼šå‰ç«¯ 3101ï¼Œåç«¯ 9999
- âœ… å°† Docker éƒ¨ç½²æ ‡è®°ä¸º"æ–¹æ³•äºŒï¼šç”Ÿäº§ç¯å¢ƒ"
- âœ… ä¿®æ­£ Docker ç«¯å£æ˜ å°„è¯´æ˜ï¼ˆ80:80 ç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰

**éªŒè¯**ï¼š
```powershell
# ç”¨æˆ·æŒ‰æ–‡æ¡£æ‰§è¡Œ
.\start-dev.ps1
# åº”çœ‹åˆ°ï¼š
# Frontend:  http://localhost:3101
# Backend:   http://localhost:9999
# API Docs:  http://localhost:9999/docs
```

### å˜æ›´ 2ï¼šREADME.md - æ‰‹åŠ¨å¯åŠ¨ç« èŠ‚ä¼˜åŒ–

**æ–‡ä»¶**ï¼š`README.md` (ç¬¬ 70-133 è¡Œ)

**å˜æ›´å†…å®¹**ï¼š
- âœ… é‡ç»„åç«¯å¯åŠ¨æ­¥éª¤ï¼ˆuv å’Œ pip ä¸¤ç§æ–¹æ³•ï¼‰
- âœ… æ˜ç¡®å‰ç«¯å¯åŠ¨æ­¥éª¤å’Œä»£ç†é…ç½®è¯´æ˜
- âœ… æ·»åŠ è®¿é—®åœ°å€å’Œå¥åº·æ£€æŸ¥ç«¯ç‚¹

**å…³é”®ä¿¡æ¯**ï¼š
```
åç«¯è®¿é—®ï¼š
- API æ–‡æ¡£ï¼šhttp://localhost:9999/docs
- å¥åº·æ£€æŸ¥ï¼šhttp://localhost:9999/api/v1/healthz

å‰ç«¯è®¿é—®ï¼šhttp://localhost:3101
ä»£ç†é…ç½®ï¼š/api/v1 â†’ http://127.0.0.1:9999
```

### å˜æ›´ 3ï¼šREADME.md - æ–°å¢"ä½¿ç”¨æŒ‡å—"ç« èŠ‚

**æ–‡ä»¶**ï¼š`README.md` (ç¬¬ 131-198 è¡Œ)

**å˜æ›´å†…å®¹**ï¼š
- âœ… æ·»åŠ å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒè®¿é—®åœ°å€å¯¹æ¯”
- âœ… åˆ—å‡ºæ‰€æœ‰æ ¸å¿ƒ API ç«¯ç‚¹ï¼ˆåŸºäºä»£ç å®é™…çŠ¶æ€ï¼‰
- âœ… è¯´æ˜è®¤è¯æµç¨‹ï¼ˆç™»å½• â†’ Token â†’ æºå¸¦ â†’ éªŒè¯ï¼‰
- âœ… è¯´æ˜ä¸­é—´ä»¶é“¾è·¯ï¼ˆCORS â†’ TraceID â†’ PolicyGate â†’ RateLimiterï¼‰

**API ç«¯ç‚¹æ¸…å•**ï¼ˆä»æºç æå–ï¼‰ï¼š
- `/api/v1/base/*` - åŸºç¡€è®¤è¯ï¼ˆç™»å½•ã€ç”¨æˆ·ä¿¡æ¯ã€èœå•ï¼‰
- `/api/v1/dashboard/*` - Dashboard æ•°æ®
- `/api/v1/health/*` - å¥åº·æ¢é’ˆï¼ˆhealthz, livez, readyzï¼‰
- `/api/v1/llm/*` - LLM æ¨¡å‹ç®¡ç†
- `/api/v1/messages/*` - æ¶ˆæ¯ä¸ SSE
- `/api/v1/metrics` - Prometheus æŒ‡æ ‡

### å˜æ›´ 4ï¼šDockerfile - æ·»åŠ ç«¯å£è¯´æ˜æ³¨é‡Š

**æ–‡ä»¶**ï¼š`Dockerfile` (ç¬¬ 30-36 è¡Œ)

**å˜æ›´å†…å®¹**ï¼š
```dockerfile
ENV LANG=zh_CN.UTF-8

# ç”Ÿäº§ç¯å¢ƒï¼šNginx ç›‘å¬ 80 ç«¯å£ï¼Œåå‘ä»£ç†åˆ°åç«¯ 9999
# å¼€å‘ç¯å¢ƒï¼šå‰ç«¯ 3101ï¼Œåç«¯ 9999ï¼ˆè§ start-dev.ps1ï¼‰
EXPOSE 80

ENTRYPOINT [ "/bin/sh", "entrypoint.sh" ]
```

**ç›®çš„**ï¼šæ˜ç¡®åŒºåˆ†ç”Ÿäº§ç¯å¢ƒå’Œå¼€å‘ç¯å¢ƒçš„ç«¯å£é…ç½®

### å˜æ›´ 5ï¼šdocker-compose.yml - æ·»åŠ ç¯å¢ƒè¯´æ˜æ³¨é‡Š

**æ–‡ä»¶**ï¼š`docker-compose.yml` (ç¬¬ 1-16 è¡Œ)

**å˜æ›´å†…å®¹**ï¼š
```yaml
version: '3.8'

services:
  # Vue FastAPI Admin ä¸»æœåŠ¡
  # ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ï¼šNginx (80) â†’ FastAPI (9999)
  # å¼€å‘ç¯å¢ƒè¯·ä½¿ç”¨ start-dev.ps1 å¯åŠ¨ï¼ˆå‰ç«¯ 3101ï¼Œåç«¯ 9999ï¼‰
  app:
    build:
      context: .
      dockerfile: Dockerfile
    image: vue-fastapi-admin:dashboard-v1
    container_name: vue-fastapi-admin
    restart: unless-stopped
    ports:
      - "80:80"  # ç”Ÿäº§ç¯å¢ƒï¼šNginx ç«¯å£
```

**ç›®çš„**ï¼šé˜²æ­¢ç”¨æˆ·æ··æ·†å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„ç«¯å£é…ç½®

### å˜æ›´ 6ï¼šAGENTS.md - ä¿®å¤å‰ç«¯ç«¯å£é”™è¯¯

**æ–‡ä»¶**ï¼š`AGENTS.md` (ç¬¬ 63-77 è¡Œ)

**å˜æ›´å‰**ï¼š
```bash
cd web && pnpm dev
# â†’ http://localhost:5173ï¼ˆä»£ç† /api åˆ°åç«¯ï¼‰
```

**å˜æ›´å**ï¼š
```bash
# ä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰
.\start-dev.ps1
# â†’ è‡ªåŠ¨å¯åŠ¨å‰ç«¯ (3101) å’Œåç«¯ (9999)

# æˆ–æ‰‹åŠ¨å¯åŠ¨ï¼š
cd web && pnpm dev
# â†’ http://localhost:3101ï¼ˆä»£ç† /api/v1 åˆ°åç«¯ 9999ï¼‰
```

### å˜æ›´ 7ï¼šCLAUDE.md - ä¿®å¤å‰ç«¯ç«¯å£é”™è¯¯

**æ–‡ä»¶**ï¼š`CLAUDE.md` (ç¬¬ 39-53 è¡Œ)

**å˜æ›´å†…å®¹**ï¼šåŒ AGENTS.mdï¼Œç¡®ä¿æ‰€æœ‰æ–‡æ¡£ç«¯å£ä¸€è‡´

---

## âœ… éªŒè¯æ­¥éª¤

### 1. æ–‡æ¡£ä¸€è‡´æ€§éªŒè¯

æ£€æŸ¥æ‰€æœ‰æ–‡æ¡£ä¸­çš„ç«¯å£é…ç½®æ˜¯å¦ä¸€è‡´ï¼š

```powershell
# æœç´¢æ‰€æœ‰ç«¯å£å¼•ç”¨
rg "localhost:3101" --type md
rg "localhost:9999" --type md
rg "localhost:5173" --type md  # åº”æ— ç»“æœï¼ˆå·²å…¨éƒ¨ä¿®å¤ï¼‰
```

**é¢„æœŸç»“æœ**ï¼š
- âœ… `3101` å‡ºç°åœ¨ README.md, AGENTS.md, CLAUDE.md
- âœ… `9999` å‡ºç°åœ¨æ‰€æœ‰ç›¸å…³æ–‡æ¡£
- âŒ `5173` ä¸åº”å‡ºç°ï¼ˆå·²å…¨éƒ¨æ›¿æ¢ä¸º 3101ï¼‰

### 2. å®é™…å¯åŠ¨éªŒè¯

æŒ‰ç…§æ›´æ–°åçš„æ–‡æ¡£æ‰§è¡Œå¯åŠ¨æµç¨‹ï¼š

```powershell
# æ–¹æ³•ä¸€ï¼šä¸€é”®å¯åŠ¨
.\start-dev.ps1

# ç­‰å¾… 10 ç§’åéªŒè¯
curl http://localhost:3101  # å‰ç«¯åº”è¿”å› HTML
curl http://localhost:9999/api/v1/healthz  # åç«¯åº”è¿”å› {"status": "healthy"}
```

### 3. API ç«¯ç‚¹éªŒè¯

è®¿é—® Swagger UI ç¡®è®¤æ–‡æ¡£ä¸­åˆ—å‡ºçš„ç«¯ç‚¹ä¸å®é™…ä¸€è‡´ï¼š

```
http://localhost:9999/docs
```

**æ£€æŸ¥æ¸…å•**ï¼š
- [ ] `/api/v1/base/access_token` å­˜åœ¨
- [ ] `/api/v1/dashboard/stats` å­˜åœ¨
- [ ] `/api/v1/health/healthz` å­˜åœ¨
- [ ] `/api/v1/llm/models` å­˜åœ¨
- [ ] `/api/v1/messages` å­˜åœ¨
- [ ] `/api/v1/metrics` å­˜åœ¨

### 4. Docker éƒ¨ç½²éªŒè¯

```bash
# æ„å»ºé•œåƒ
docker build -t vue-fastapi-admin .

# å¯åŠ¨å®¹å™¨
docker run -d --name test-admin -p 80:80 vue-fastapi-admin

# éªŒè¯è®¿é—®
curl http://localhost  # åº”è¿”å›å‰ç«¯é¡µé¢
curl http://localhost/api/v1/healthz  # åº”è¿”å›å¥åº·çŠ¶æ€

# æ¸…ç†
docker stop test-admin && docker rm test-admin
```

---

## ğŸ“‹ SSOT åˆè§„æ€§æ£€æŸ¥

### å•ä¸€çœŸå€¼æ¥æºéªŒè¯

| é…ç½®é¡¹ | çœŸå€¼æ¥æºï¼ˆä»£ç ï¼‰ | æ–‡æ¡£å¼•ç”¨ä½ç½® | çŠ¶æ€ |
|--------|------------------|--------------|------|
| å‰ç«¯ç«¯å£ | `web/.env.development` (3101) | README.md, AGENTS.md, CLAUDE.md | âœ… ä¸€è‡´ |
| åç«¯ç«¯å£ | `run.py` (9999) | README.md, AGENTS.md, CLAUDE.md | âœ… ä¸€è‡´ |
| ä»£ç†é…ç½® | `web/build/constant.js` (/api/v1 â†’ 9999) | README.md | âœ… ä¸€è‡´ |
| API è·¯ç”± | `app/api/v1/__init__.py` | README.md ä½¿ç”¨æŒ‡å— | âœ… ä¸€è‡´ |
| ä¸­é—´ä»¶é“¾ | `app/core/application.py` | README.md ä½¿ç”¨æŒ‡å— | âœ… ä¸€è‡´ |

### æ— å½±å­çŠ¶æ€

- âœ… æ‰€æœ‰ç«¯å£é…ç½®å‡å¼•ç”¨å®é™…ä»£ç ä¸­çš„å€¼
- âœ… API ç«¯ç‚¹åˆ—è¡¨ä»è·¯ç”±æ³¨å†Œä»£ç æå–
- âœ… ä¸­é—´ä»¶é“¾è·¯ä» `create_app()` å‡½æ•°æå–
- âœ… æ— è‡†æµ‹æˆ–è¿‡æ—¶çš„é…ç½®ä¿¡æ¯

---

## ğŸ¯ ç”¨æˆ·å½±å“

### æ–°ç”¨æˆ·ä½“éªŒæ”¹è¿›

**æ”¹è¿›å‰**ï¼š
- æ–‡æ¡£ä¸­å‰ç«¯ç«¯å£é”™è¯¯ï¼ˆ5173 vs å®é™… 3101ï¼‰
- ç¼ºå°‘ä¸€é”®å¯åŠ¨è¯´æ˜
- API ç«¯ç‚¹åˆ—è¡¨ä¸å®Œæ•´

**æ”¹è¿›å**ï¼š
- âœ… æ¨èä½¿ç”¨ `start-dev.ps1` ä¸€é”®å¯åŠ¨
- âœ… æ‰€æœ‰ç«¯å£é…ç½®å‡†ç¡®æ— è¯¯
- âœ… å®Œæ•´çš„ API ç«¯ç‚¹æ¸…å•å’Œè®¤è¯æµç¨‹è¯´æ˜
- âœ… æ˜ç¡®åŒºåˆ†å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒ

### å¼€å‘è€…ä½“éªŒæ”¹è¿›

**æ”¹è¿›å‰**ï¼š
- éœ€è¦æ‰‹åŠ¨æŸ¥æ‰¾ç«¯å£é…ç½®
- ä¸æ¸…æ¥šå‰ç«¯ä»£ç†å¦‚ä½•å·¥ä½œ
- ç¼ºå°‘ä¸­é—´ä»¶é“¾è·¯è¯´æ˜

**æ”¹è¿›å**ï¼š
- âœ… æ–‡æ¡£ä¸­ç›´æ¥æä¾›æ‰€æœ‰è®¿é—®åœ°å€
- âœ… æ˜ç¡®è¯´æ˜ä»£ç†é…ç½®ï¼ˆ/api/v1 â†’ 9999ï¼‰
- âœ… å®Œæ•´çš„ä¸­é—´ä»¶é“¾è·¯è¯´æ˜
- âœ… è®¤è¯æµç¨‹å›¾æ¸…æ™°

---

## ğŸ“ åç»­å»ºè®®

### 1. è‡ªåŠ¨åŒ–éªŒè¯ï¼ˆå¯é€‰ï¼‰

åˆ›å»ºæ–‡æ¡£éªŒè¯è„šæœ¬ `scripts/verify_docs.py`ï¼š

```python
"""éªŒè¯æ–‡æ¡£ä¸­çš„ç«¯å£é…ç½®ä¸ä»£ç ä¸€è‡´"""
import re
from pathlib import Path

def verify_ports():
    # ä»ä»£ç ä¸­æå–çœŸå®ç«¯å£
    vite_config = Path("web/.env.development").read_text()
    frontend_port = re.search(r"VITE_PORT = (\d+)", vite_config).group(1)
    
    run_py = Path("run.py").read_text()
    backend_port = re.search(r'port=(\d+)', run_py).group(1)
    
    # éªŒè¯æ‰€æœ‰æ–‡æ¡£
    docs = ["README.md", "AGENTS.md", "CLAUDE.md"]
    for doc in docs:
        content = Path(doc).read_text()
        assert f"localhost:{frontend_port}" in content
        assert f"localhost:{backend_port}" in content
        assert "localhost:5173" not in content  # æ—§ç«¯å£ä¸åº”å­˜åœ¨
    
    print("âœ… æ‰€æœ‰æ–‡æ¡£ç«¯å£é…ç½®ä¸€è‡´")

if __name__ == "__main__":
    verify_ports()
```

### 2. æ–‡æ¡£ç»´æŠ¤è§„èŒƒ

åœ¨ `CONTRIBUTING.md` ä¸­æ·»åŠ ï¼š

```markdown
## æ–‡æ¡£æ›´æ–°è§„èŒƒ

1. **ç«¯å£é…ç½®**ï¼šæ‰€æœ‰ç«¯å£å¼•ç”¨å¿…é¡»ä¸ä»£ç ä¸€è‡´
   - å‰ç«¯ï¼š`web/.env.development` ä¸­çš„ `VITE_PORT`
   - åç«¯ï¼š`run.py` ä¸­çš„ `port` å‚æ•°

2. **API ç«¯ç‚¹**ï¼šä» `app/api/v1/__init__.py` æå–å®é™…è·¯ç”±

3. **éªŒè¯æ­¥éª¤**ï¼šæ›´æ–°æ–‡æ¡£åè¿è¡Œ `python scripts/verify_docs.py`
```

### 3. CI/CD é›†æˆï¼ˆå¯é€‰ï¼‰

åœ¨ GitHub Actions ä¸­æ·»åŠ æ–‡æ¡£éªŒè¯æ­¥éª¤ï¼š

```yaml
- name: Verify Documentation
  run: python scripts/verify_docs.py
```

---

## ğŸ äº¤ä»˜æ¸…å•

- [x] ç°çŠ¶åˆ†ææŠ¥å‘Šï¼ˆç«¯å£é…ç½®ã€æ–‡æ¡£å·®å¼‚ã€API ç«¯ç‚¹ï¼‰
- [x] README.md æ›´æ–°ï¼ˆå¿«é€Ÿå¼€å§‹ã€æ‰‹åŠ¨å¯åŠ¨ã€ä½¿ç”¨æŒ‡å—ï¼‰
- [x] Dockerfile æ·»åŠ ç«¯å£è¯´æ˜æ³¨é‡Š
- [x] docker-compose.yml æ·»åŠ ç¯å¢ƒè¯´æ˜æ³¨é‡Š
- [x] AGENTS.md ä¿®å¤å‰ç«¯ç«¯å£é”™è¯¯
- [x] CLAUDE.md ä¿®å¤å‰ç«¯ç«¯å£é”™è¯¯
- [x] éªŒè¯æ­¥éª¤æ–‡æ¡£
- [x] SSOT åˆè§„æ€§æ£€æŸ¥
- [x] äº¤ä»˜æŠ¥å‘Šï¼ˆæœ¬æ–‡æ¡£ï¼‰

---

## ğŸ“ é—®é¢˜åé¦ˆ

å¦‚å‘ç°æ–‡æ¡£ä¸å®é™…ä»£ç ä¸ä¸€è‡´ï¼Œè¯·ï¼š

1. æ£€æŸ¥ä»£ç å®é™…çŠ¶æ€ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
2. æäº¤ Issue è¯´æ˜å·®å¼‚
3. è¿è¡Œ `python scripts/verify_docs.py` éªŒè¯

**è®°ä½**ï¼šä»£ç æ˜¯å”¯ä¸€çœŸå€¼æ¥æºï¼ˆSSOTï¼‰ï¼Œæ–‡æ¡£å¿…é¡»è·Ÿéšä»£ç æ›´æ–°ã€‚

