ID,Title,Description,Acceptance,Test_Method,Tools,Dev_Status,Review1_Status,Regression_Status,Files,Dependencies,Notes
A1,后端：SSE events 豁免限流,将 `GET /api/v1/messages/*/events` 从 QPS/日限流计数中豁免，避免浏览器/代理重连导致 429；并发仍由 `sse_guard` 控制。,在 `/ai/jwt` 发起对话后不再出现 429；SSE 能持续直到 completed 或 error。,本地启动后用真实/匿名 JWT 连续多次请求 `/messages/*/events` 不返回 429。,functions:exec_command;functions:apply_patch,DONE,TODO,TODO,app/core/rate_limiter.py,app/core/sse_guard.py,需确认已部署到本地 docker 与 FRP 映射端点。
A2,后端：匿名 JWT 当日复用持久化,匿名模式一键生成并写入本地 SQLite（保存 refresh_token + 当日 label），当天再次点击优先 refresh 复用；支持 `force_new` 强制新建。,当天重复调用接口不会无限创建匿名用户；`force_new=true` 会创建新匿名并覆盖当日记录。,调用 `/api/v1/llm/tests/anon-token` 两次：第二次返回 refreshed/created 且 access_token 可用；重启 docker 后仍可复用。,functions:exec_command;functions:apply_patch,TODO,TODO,TODO,app/api/v1/llm_tests.py;app/db/sqlite_manager.py;web/src/views/test/real-user-sse.vue,SUPABASE_URL;SUPABASE_ANON_KEY,前端可继续保留 localStorage 缓存，但以服务端持久化为准（SSOT）。
A3,部署验证：复用 docker 与端到端复测,复用现有 docker 服务重建 app 并验证映射域名；确保 create-mail-user 与匿名链路失败时返回 JSON（含 request_id/hint），而非 Cloudflare 5xx HTML。,`docker compose ps` 显示 app healthy；本机与 `web.gymbro.cloud/ai/jwt` 都能完成闭环。,`docker compose up -d --build app` 后执行健康检查与 `/ai/jwt` 手工复测。,functions:exec_command,TODO,TODO,TODO,docker-compose.yml;plan/2026-01-02_15-39-30-jwt-sse-429-502.md,FRP 正常;MAIL_API_KEY,若仍出现 502，优先排查 FRP/反代链路是否断连或超时（先本机 curl 再外网）。
