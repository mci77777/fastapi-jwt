ID,Title,Description,Acceptance,Test_Method,Tools,Dev_Status,Review1_Status,Regression_Status,Files,Dependencies,Notes
C1,"后端：冻结 App 下发契约（以现状为准）","以 `tests/test_exercise_library_contracts.py` 与 `docs/后端方案/动作库-种子数据库scheme-现状.md` 为 SSOT，确认并固化 `/api/v1/exercise/library/{meta,full,updates}` 的字段/类型/错误语义；消除与“后端须知”不一致造成的漂移风险。","`meta/full/updates` 响应体字段与类型稳定且与合约测试一致；增量不可得返回明确错误可触发客户端回退。","运行 `pytest -q tests/test_exercise_library_contracts.py` 全绿；手动 curl 三端点检查字段。","feedback:codebase-retrieval;functions:exec_command;functions:apply_patch",TODO,TODO,TODO,"app/api/v1/exercise_library.py;app/services/exercise_library_service.py;docs/后端方案/动作库-种子数据库scheme-后端须知.md","ExerciseLibraryService","如需保留“后端须知”版本字段，必须显式写兼容策略或弃用说明，避免双契约。"
C2,"后端：Admin 发布入口（仅 admin 可用）","新增/完善 `POST /api/v1/admin/exercise/library/publish`：上传 seed JSON（或引用路径）-> 校验 -> 调用发布逻辑写入 `exercise_library_snapshots` 并返回最新 meta；要求 admin 鉴权与错误响应一致。","匿名/非 admin 调用被拒绝；admin 发布成功后 `meta.version` 单调递增且下发端点可读到最新版本。","用 admin 凭证调用 publish -> 再调用 `GET /api/v1/exercise/library/meta` 验证版本推进；补充对应 API 测试（如项目已有 auth 测试基建）。","feedback:codebase-retrieval;functions:exec_command;functions:apply_patch",TODO,TODO,TODO,"app/api/v1/admin/*;app/services/exercise_library_service.py;app/core/policy_gate.py","app/auth/*;PolicyGateMiddleware","需要明确“admin 用户”的判定来源（本地 local_users / Supabase JWT claim / 角色表）。"
C3,"后端：发布校验与 SSOT 收敛","发布与下发共用同一套校验/规范化逻辑（checksum、排序、canonical JSON、extra 字段策略）；脚本 `scripts/publish_exercise_seed.py` 与 API 发布入口复用同一路径，避免影子实现。","同一份 seed 通过脚本/API 发布得到一致 checksum；无效 seed 返回可定位错误码且不落库。","对同一 seed 分别运行脚本与 API 发布并比对 meta.checksum；构造非法字段/空数组触发 4xx 且无新版本写入。","feedback:codebase-retrieval;functions:exec_command;functions:apply_patch",TODO,TODO,TODO,"scripts/publish_exercise_seed.py;app/services/exercise_library_service.py","ExerciseLibraryService","注意当前 DTO `extra=forbid`：如需要前向兼容需显式调整并同步更新测试。"
C4,"测试/回归：发布→下发闭环验证","补齐发布入口与下发端点的回归路径（pytest + 冒烟脚本/说明），确保版本推进、增量/回退、鉴权均可复现。","CI/本地可一键复现：发布新种子 -> meta/version 变化 -> full 可取 -> updates 可取或明确失败（触发回退）。","运行 pytest；按文档步骤执行 publish+curl 冒烟。","functions:exec_command;functions:apply_patch",TODO,TODO,TODO,"tests/*;docs/task/*","C1;C2;C3","保持验证步骤可复制粘贴，避免依赖日志定位。"
