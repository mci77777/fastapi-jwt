ID,Title,Description,Acceptance,Test_Method,Tools,Dev_Status,Review1_Status,Regression_Status,Files,Dependencies,Notes
C1,后端：SSE error 也能对账 provider/resolved_model,"将 routed 事件提前到上游调用前发布；上游超时/失败时 SSE error 仍带 provider/resolved_model/endpoint_id。","上游失败时仍能从 SSE status:routed / error 中拿到 provider/resolved_model/endpoint_id；并且所有事件均带 request_id。","运行 xAI E2E 脚本：server/passthrough 两种模式均通过；强制制造上游超时后 error 事件仍带 provider/resolved_model。","functions:exec_command;functions:apply_patch",DONE,TODO,TODO,"app/services/ai_service.py","AIConfigService;ModelMappingService","本轮已在真实 xAI E2E 中验证通过（trace 见 artifacts）。"
C2,后端：上游请求使用 endpoint.timeout（避免 ReadTimeout）,"OpenAI/Claude 上游请求超时使用 endpoint.timeout（若无则回退全局 http_timeout_seconds）。","将 endpoint.timeout 设为较大值时，上游慢响应不再在 10s 内抛 ReadTimeout。","运行 xAI E2E：server/passthrough 均通过（本轮端点 timeout=120）。","functions:exec_command;functions:apply_patch",DONE,TODO,TODO,"app/services/ai_service.py;scripts/monitoring/xai_mapped_model_passthrough_e2e.py","C1","不改全局默认，仅尊重端点配置。"
C3,后端：server 模式默认禁用 tool_calls（无执行器）,"当后端注入 tools 且未显式指定 tool_choice 时，默认设置 tool_choice=none，避免模型返回 tool_calls 导致 upstream_empty_content。","server 模式在开启 tools 的情况下也能稳定返回 completed.reply；不再因为 tool_calls 触发空 content 而失败。","运行 xAI E2E（server 模式）通过；并新增单测覆盖工具调用场景错误提示。","functions:exec_command;functions:apply_patch",TODO,TODO,TODO,"app/services/ai_service.py;tests/test_request_id_ssot_e2e.py",C1,"passthrough 模式不做覆盖，保持完全透传语义。"
C4,后端：tool_calls 无内容时给出明确错误,"当 upstream 返回 tool_calls 但 message.content 为空时，返回明确错误（tool_calls_not_supported + tool 名单摘要），并在 SSE error 中透传 request_id。","遇到 tool_calls 时不会出现空字符串错误；能从 error 字段快速定位原因与工具名。","pytest：mock OpenAI 返回 tool_calls 且 content 为空，断言 SSE error 包含 tool_calls_not_supported。","functions:exec_command;functions:apply_patch",TODO,TODO,TODO,"app/services/ai_service.py;tests/test_request_id_ssot_e2e.py",C3,"避免输出完整 tool 参数，防止泄露用户输入。"
C5,脚本：grok-4.1-思考→xAI 实际 model id 自适配,"脚本对 `XAI_PROVIDER_MODEL=grok-4.1-思考` 做别名解析，自动选取 /v1/models 中实际可用 id（如 grok-4-1-fast-reasoning）。","即使用户写了“人类别名”，脚本仍能完成映射与对话调用。","运行 xAI E2E 脚本（无需手动改模型 id）通过。","functions:exec_command;functions:apply_patch",DONE,TODO,TODO,"scripts/monitoring/xai_mapped_model_passthrough_e2e.py",,"已在本轮真实 xAI E2E 通过。"
