ID,Title,Description,Acceptance,Test_Method,Tools,Dev_Status,Review1_Status,Regression_Status,Files,Dependencies,Notes
JSONSEQ-001,新增 JSONSeq v1 协议 SSOT 文档,定义与 ThinkingML(XML) 语义等价的 JSONSeq v1：统一事件类型（thinking_start/phase_start/phase_delta/thinking_end/final_delta/final_end，可选 serp_summary/serp_queries）+ 字段白名单 + 顺序约束 + 失败策略,新增 docs/ai_jsonseq_v1_预期响应结构.md 且包含事件定义/示例/校验规则/回滚说明,阅读校验：rg/markdown 评审 + pytest 覆盖 validator,feedback:codebase-retrieval;functions:apply_patch,DONE,TODO,DONE,docs/ai_jsonseq_v1_预期响应结构.md,NONE,SSOT：客户端只认事件；默认保持旧 SSE 协议
JSONSEQ-002,新增 JSONSeq v1 Prompt（assets）与 profile,新增 system/tools 两份 prompt（JSON Lines 事件序列 + ToolCall 语义对齐）与 profile 元数据；为避免与现有 prompt_type 冲突，引入独立 prompt_type（system_jsonseq_v1/tools_jsonseq_v1）,1) assets 中新增 3 个文件 2) 启动期可种子化到 ai_prompts（独立 prompt_type）且不影响现有 system/tools,make test + 本地 mock E2E 覆盖注入,feedback:codebase-retrieval;functions:apply_patch;functions:shell_command,DONE,TODO,DONE,assets/prompts/serp_prompt_jsonseq_v1.md assets/prompts/tool_jsonseq_v1.md assets/prompts/standard_jsonseq_v1.json app/services/ai_config_service.py app/services/ai_service.py,JSONSEQ-001,Prompt 必须包含“保密/拒绝复述 system prompt”与 SERP 事件规则
JSONSEQ-003,App 配置项：output_protocol（SQLite SSOT）,在 llm_app_settings 增加 app_output_protocol（thinkingml_v45/jsonseq_v1），并在 /api/v1/llm/app/config 读写；messages 创建时固化到 broker.meta,1) GET/POST /api/v1/llm/app/config 可读写 app_output_protocol 2) 默认值为 thinkingml_v45（不变更现网）,pytest 覆盖 config 读写 + schema 校验,feedback:codebase-retrieval;functions:apply_patch,DONE,TODO,DONE,app/api/v1/llm_models.py app/api/v1/messages.py app/services/ai_service.py,JSONSEQ-001,保持 extra=forbid；仅新增允许字段
JSONSEQ-004,SSE：统一事件类型输出管线,当 app_output_protocol=jsonseq_v1：对上游输出（XML/JSON/PlainText）做最小解析并输出统一事件（thinking_start/phase_* / final_* + serp_*）；仍保留 status/heartbeat/error,1) SSE 在 jsonseq_v1 模式下能输出事件序列且可被 validator 校验 2) XML/PlainText 兜底不会中断流式,pytest（事件输出/顺序/兜底）+ 本地 mock E2E,feedback:codebase-retrieval;functions:apply_patch;functions:shell_command,DONE,TODO,DONE,app/services/ai_service.py app/api/v1/messages.py tests/test_sse_jsonseq_v1_events_e2e.py,JSONSEQ-003,端到端：触发→流式→终止→错误路径；completed.reply 不作为 SSOT
JSONSEQ-005,Dashboard：App 输出协议开关,在 Dashboard AI 配置页增加 app_output_protocol 选择（ThinkingML/XML vs JSONSeq/v1），写入 /api/v1/llm/app/config,UI 可切换并提示“默认不变；仅开启后 App 侧需按事件处理”,vite build + 手工冒烟（页面加载/保存）,functions:apply_patch;functions:shell_command,DONE,TODO,DONE,web/src/views/system/ai/index.vue web/src/views/system/ai/prompt/index.vue web/src/views/ai/model-suite/jwt/RealUserSseSsot.vue,JSONSEQ-003,文案需说明：客户端只认事件；未知事件忽略
JSONSEQ-006,新增 JSONSeq v1 validator 与回归测试,新增 validator（支持流式拼接后校验）与 pytest；扩展/新增 mock E2E 脚本验证 jsonseq_v1 输出,pytest 全绿（含新增用例）且 local_mock_e2e PASS,.venv/bin/python -m pytest -q tests/test_jsonseq_v1_validator.py,functions:apply_patch;functions:shell_command,DOING,TODO,TODO,tests/test_sse_jsonseq_v1_events_e2e.py docs/prompt_jsonseq/test_results.md,JSONSEQ-004,已新增 E2E 校验用例；后续抽取独立 validator 并补齐 local_mock_e2e PASS 证据
JSONSEQ-007,xai：JSONSeq v1 prompt 迭代到 100% PASS,基于真实 E2E 失败样式迭代 jsonseq prompts，直到 xai runs/turns 100% 合规；归档到 docs/prompt_jsonseq/,docs/prompt_jsonseq/test_results.md 记录 xai 通过率=100% 且 prompt 版本归档可回退,python scripts/monitoring/real_ai_conversation_e2e.py（指定 jsonseq 模式） + 记录结果,functions:shell_command;feedback:codebase-retrieval,TODO,TODO,TODO,docs/prompt_jsonseq/CHANGELOG.md docs/prompt_jsonseq/test_results.md assets/prompts/serp_prompt_jsonseq_v1.md,JSONSEQ-002,先稳定 xai，再扩展其它模型
JSONSEQ-008,多模型扩展与最小公约版本,在 xai 稳定后，依次验证 claude/gemini/gpt/deepseek；按失败样式做最小增补并归档版本,所有目标模型在 jsonseq_v1 模式下 runs/turns 达标（按 test_results.md 记录）,python scripts/monitoring/real_ai_conversation_e2e.py --models ...,functions:shell_command;feedback:codebase-retrieval,TODO,TODO,TODO,docs/prompt_jsonseq/test_results.md docs/prompt_jsonseq/CHANGELOG.md assets/prompts/serp_prompt_jsonseq_v1.md,JSONSEQ-007,若模型不可用/端点异常需在 Notes 记录并跳过
